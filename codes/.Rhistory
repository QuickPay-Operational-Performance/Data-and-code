geom_line()
full_df_tr[,start_yr_qtr:=as.yearqtr(initial_start_date, format = "%Y-%m-%d")]
a=full_df_tr[initial_start_date>=as.Date('2009-12-31'),
.(num_projects=n_distinct(contract_award_unique_key),
num_contractors=n_distinct(recipient_duns)),
by=c('start_yr_qtr',
'contracting_officers_determination_of_business_size_code')]
a[,start_yr_qtr_dt:=as.Date(start_yr_qtr)]
setnames(a,'contracting_officers_determination_of_business_size_code','size')
ggplot(a[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=num_projects,
group=size,
linetype=size))+
geom_line()
ggplot(a[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=num_contractors,
group=size,
linetype=size))+
geom_line()
b=full_df_tr[initial_start_date>=as.Date('2009-12-31'),
.(num_projects=n_distinct(contract_award_unique_key),
num_contractors=n_distinct(recipient_duns)),
by=c('start_yr_qtr')]
ggplot(b[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=num_contractors))+
geom_line()
b[,start_yr_qtr_dt:=as.Date(start_yr_qtr)]
ggplot(b[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=num_contractors))+
geom_line()
a=full_df_tr[initial_start_date>=as.Date('2009-12-31'),
.(num_projects=n_distinct(contract_award_unique_key),
num_contractors=n_distinct(recipient_duns)),
by=c('start_yr_qtr',
'contracting_officers_determination_of_business_size_code')]
a[,start_yr_qtr_dt:=as.Date(start_yr_qtr)]
setnames(a,'contracting_officers_determination_of_business_size_code','size')
ggplot(a[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=num_projects,
group=size,
linetype=size))+
geom_line()+
theme_minimal()
ggplot(a[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=num_contractors,
group=size,
linetype=size))+
geom_line()+
theme_minimal()
b=full_df_tr[initial_start_date>=as.Date('2009-12-31'),
.(num_projects=n_distinct(contract_award_unique_key),
num_contractors=n_distinct(recipient_duns)),
by=c('start_yr_qtr')]
b[,start_yr_qtr_dt:=as.Date(start_yr_qtr)]
ggplot(b[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=num_contractors))+
geom_line()+
theme_minimal()
knitr::opts_chunk$set(echo = TRUE)
library(fixest)
library(DescTools)
library(data.table)
library(dplyr)
library(MatchIt)
library(zoo)
library(ggplot2)
data_folder='/Users/vibhutid_admin/Dropbox/data_quickpay/qp_data/'
# Keep only projects whose start dates match with API one
projects_to_keep=fread(paste0(data_folder,'projects_to_keep.csv'))
full_df=fread('/Users/vibhutid_admin/Dropbox/data_quickpay/qp_data/qp_data_fy10_to_fy18.csv')
full_df_tr=setDT(full_df[,c('contract_award_unique_key',
'contracting_officers_determination_of_business_size_code',
'period_of_performance_start_date',
'period_of_performance_current_end_date',
'action_date',
'naics_code',
'product_or_service_code',
'awarding_sub_agency_code',
'contract_financing_code',
'base_and_all_options_value',
'extent_competed_code',
'recipient_duns',
'action_type_code',
'number_of_offers_received',
'type_of_set_aside_code',
'type_of_set_aside')])
# date formats
full_df_tr[,action_date:=as.Date(action_date)]
full_df_tr[,period_of_performance_current_end_date:=
as.Date(period_of_performance_current_end_date)]
full_df_tr[,period_of_performance_start_date:=
as.Date(period_of_performance_start_date)]
full_df_tr=full_df_tr[action_date<=period_of_performance_current_end_date &
action_date>=period_of_performance_start_date]
# Action dates before July 1, 2012 --- QP extended to everyone after that
full_df_tr=full_df_tr[action_date<as.Date('2012-07-01')]
# Get initial and final dates
full_df_tr=full_df_tr[order(contract_award_unique_key,
action_date)]
dates=full_df_tr[,.(initial_end_date = first(period_of_performance_current_end_date), # first reported end date
eventual_end_date = last(period_of_performance_current_end_date),  # last reported end date
initial_start_date = first(period_of_performance_start_date),
initial_budget=first(base_and_all_options_value)), # first reported start date
by='contract_award_unique_key']
full_df_tr=merge(full_df_tr,
dates,
by='contract_award_unique_key',
all.x=T)
full_df_tr[,start_yr_qtr:=as.yearqtr(initial_start_date, format = "%Y-%m-%d")]
full_df_tr[,delay:=as.numeric(eventual_end_date-initial_end_date)]
full_df_tr[,positive_delay:=ifelse(delay>0,1,0)]
full_df_tr[,negative_delay:=ifelse(delay<0,1,0)]
full_df_tr[,initial_duration:=as.numeric(initial_end_date-initial_start_date)]
full_df_tr[,contract_financing_i:=ifelse(!is.null(contract_financing_code)&
!contract_financing_code%in%c("Z", ""),1,0)]
# Competition_i
full_df_tr[,competitively_awarded_i:=ifelse(!extent_competed_code%in%c("G","B", "C"),1,0)]
full_df_tr[,treat_i:=ifelse(contracting_officers_determination_of_business_size_code=="S",
1,0)]
# projects that start after QuickPay
# full_df_tr[,post_t:=ifelse(initial_start_date>as.Date('2011-04-27'),
#                               1,0)]
# projects that were slated to end after QuickPay
full_df_tr[,post_t:=ifelse(initial_end_date>as.Date('2011-04-27'),
1,0)]
full_df_tr[,relative_delay:=delay/initial_duration]
large=full_df_tr[contracting_officers_determination_of_business_size_code=='O' &
initial_start_date>=as.Date('2009-12-31'),
.(num_large_projects=n_distinct(contract_award_unique_key),
num_large_contractors=n_distinct(recipient_duns)),
by=c('start_yr_qtr')]
large[is.na(large)]=0
both=merge(small, large, by='start_yr_qtr')
small
small=full_df_tr[contracting_officers_determination_of_business_size_code=='S' &
initial_start_date>=as.Date('2009-12-31'),
.(num_small_projects=n_distinct(contract_award_unique_key),
num_small_contractors=n_distinct(recipient_duns)),
by=c('start_yr_qtr')]
small[is.na(small)]=0
large=full_df_tr[contracting_officers_determination_of_business_size_code=='O' &
initial_start_date>=as.Date('2009-12-31'),
.(num_large_projects=n_distinct(contract_award_unique_key),
num_large_contractors=n_distinct(recipient_duns)),
by=c('start_yr_qtr')]
large[is.na(large)]=0
both=merge(small, large, by='start_yr_qtr',all=T)
both[,start_yr_qtr_dt:=as.Date(start_yr_qtr)]
both[,pc_small_projects:=num_small_projects/(num_small_projects+num_large_projects)]
both[,pc_small_projects:=num_small_contractors/(num_small_contractors+num_large_contractors)]
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_projects))+
geom_line()+
theme_minimal()
small=full_df_tr[contracting_officers_determination_of_business_size_code=='S' &
initial_start_date>=as.Date('2009-12-31'),
.(num_small_projects=n_distinct(contract_award_unique_key),
num_small_contractors=n_distinct(recipient_duns)),
by=c('start_yr_qtr')]
small[is.na(small)]=0
large=full_df_tr[contracting_officers_determination_of_business_size_code=='O' &
initial_start_date>=as.Date('2009-12-31'),
.(num_large_projects=n_distinct(contract_award_unique_key),
num_large_contractors=n_distinct(recipient_duns)),
by=c('start_yr_qtr')]
large[is.na(large)]=0
both=merge(small, large, by='start_yr_qtr',all=T)
both[,start_yr_qtr_dt:=as.Date(start_yr_qtr)]
both[,pc_small_projects:=num_small_projects/(num_small_projects+num_large_projects)]
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_projects))+
geom_line()+
theme_minimal()
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()
both[,pc_small_contractors:=num_small_contractors/(num_small_contractors+num_large_contractors)]
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
scale_y_continuous(breaks = round(seq(0.25, 0.75, by = 0.5),1)) +
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
scale_y_continuous(breaks = round(seq(0.25, 0.75, by = 0.5),1))
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
scale_x_continuous(breaks = seq(0.25, 0.75, by = 0.5))
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0,1)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0.25,0.75)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0,1)+xlim(0,5)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0,1)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0.6,0.7)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0.5,0.8)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0.6,0.8)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0.65,0.75)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0,1)+geom_vline(xintercept = 5)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0,1)+geom_vline(xintercept = 3,color='black')
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0,1)+geom_vline(xintercept = 15)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0,1)+geom_vline(xintercept = 1)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0,1)+geom_vline(xintercept = 0.015)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0,1)+geom_vline(xintercept = 25)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0,1)+geom_vline(xintercept = 155)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=start_yr_qtr_dt,
y=pc_small_contractors))+
geom_line()+
theme_minimal()+geom_vline(xintercept = 5)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors))+
geom_line()+
theme_minimal()+
ylim(0,1)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,group=1))+
geom_line()+
theme_minimal()+
ylim(0,1)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,
group=1))+
geom_line()+
theme_minimal()+
ylim(0.25,0.75)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,
group=1))+
geom_line()+
theme_minimal()+
ylim(0.55,0.75)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,
group=1))+
geom_line()+
theme_minimal()+
ylim(0.65,0.75)
ylab("Percentage of small projects")
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_projects,
group=1))+
geom_line()+
theme_minimal()+
ylim(25,75)+
xlab("Starting year-quarter")+
ylab("Percentage of small projects")
both[,pc_small_contractors:=100*num_small_contractors/(num_small_contractors+num_large_contractors)]
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,
group=1))+
geom_line()+
theme_minimal()+
ylim(25,75)+
xlab("Starting year-quarter")+
ylab("Percentage of small project contractors")
small=full_df_tr[contracting_officers_determination_of_business_size_code=='S' &
initial_start_date>=as.Date('2009-12-31'),
.(num_small_projects=n_distinct(contract_award_unique_key),
num_small_contractors=n_distinct(recipient_duns)),
by=c('start_yr_qtr')]
small[is.na(small)]=0
large=full_df_tr[contracting_officers_determination_of_business_size_code=='O' &
initial_start_date>=as.Date('2009-12-31'),
.(num_large_projects=n_distinct(contract_award_unique_key),
num_large_contractors=n_distinct(recipient_duns)),
by=c('start_yr_qtr')]
large[is.na(large)]=0
both=merge(small, large, by='start_yr_qtr',all=T)
both[,start_yr_qtr_dt:=as.Date(start_yr_qtr)]
both[,pc_small_projects:=100*num_small_projects/(num_small_projects+num_large_projects)]
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_projects,
group=1))+
geom_line()+
theme_minimal()+
ylim(25,75)+
xlab("Starting year-quarter")+
ylab("Percentage of small projects")
both[,pc_small_contractors:=100*num_small_contractors/(num_small_contractors+num_large_contractors)]
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,
group=1))+
geom_line()+
theme_minimal()+
ylim(25,75)+
xlab("Starting year-quarter")+
ylab("Percentage of small project contractors")
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_projects,
group=1))+
geom_line()+
theme_minimal()+
ylim(60,80)+
xlab("Starting year-quarter")+
ylab("Percentage of small projects")
both[,pc_small_contractors:=100*num_small_contractors/(num_small_contractors+num_large_contractors)]
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,
group=1))+
geom_line()+
theme_minimal()+
ylim(60,80)+
xlab("Starting year-quarter")+
ylab("Percentage of small project contractors")
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_projects,
group=1))+
geom_line()+
theme_minimal()+
ylim(50,70)+
xlab("Starting year-quarter")+
ylab("Percentage of small projects")
both[,pc_small_contractors:=100*num_small_contractors/(num_small_contractors+num_large_contractors)]
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,
group=1))+
geom_line()+
theme_minimal()+
ylim(60,80)+
xlab("Starting year-quarter")+
ylab("Percentage of small project contractors")
small=full_df_tr[contracting_officers_determination_of_business_size_code=='S' &
initial_start_date>=as.Date('2009-12-31'),
.(num_small_projects=n_distinct(contract_award_unique_key),
num_small_contractors=n_distinct(recipient_duns)),
by=c('start_yr_qtr')]
small[is.na(small)]=0
large=full_df_tr[contracting_officers_determination_of_business_size_code=='O' &
initial_start_date>=as.Date('2009-12-31'),
.(num_large_projects=n_distinct(contract_award_unique_key),
num_large_contractors=n_distinct(recipient_duns)),
by=c('start_yr_qtr')]
large[is.na(large)]=0
both=merge(small, large, by='start_yr_qtr',all=T)
both[,start_yr_qtr_dt:=as.Date(start_yr_qtr)]
both[,pc_small_projects:=100*num_small_projects/(num_small_projects+num_large_projects)]
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_projects,
group=1))+
geom_line()+
theme_minimal()+
ylim(55,70)+
xlab("Starting year-quarter")+
ylab("Percentage of small projects")
both[,pc_small_contractors:=100*num_small_contractors/(num_small_contractors+num_large_contractors)]
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,
group=1))+
geom_line()+
theme_minimal()+
ylim(60,75)+
xlab("Starting year-quarter")+
ylab("Percentage of small project contractors")
both[,after_qp:=fifelse(start_yr_qtr_dt>as.Date('2011-04-27'),1,0)]
both
m=feols(pc_small_contractors~after_qp|start_yr_qtr_dt,data=both)
tidy(m)
m=feols(pc_small_contractors~start_yr_qtr_dt,data=both)
tidy(m)
summary(m)
m=feols(pc_small_contractors~as.factor(start_yr_qtr_dt),data=both)
summary(m)
m=feols(pc_small_contractors~after_qp,data=both)
tidy(m)
summary(m)
a
a=full_df_tr[initial_start_date>=as.Date('2009-12-31'),
.(num_projects=n_distinct(contract_award_unique_key),
num_contractors=n_distinct(recipient_duns)),
by=c('start_yr_qtr',
'contracting_officers_determination_of_business_size_code')]
a[,start_yr_qtr_dt:=as.Date(start_yr_qtr)]
setnames(a,'contracting_officers_determination_of_business_size_code','size')
a
a[,after_qp:=fifelse(start_yr_qtr_dt>as.Date('2011-04-27'),1,0)]
m=feols(num_projects~size*after_qp|start_yr_qtr_dt,data=a)
summary(m)
m=feols(num_projects~size*after_qp,data=a)
summary(m)
m=feols(num_contractors~size*after_qp,data=a)
summary(m)
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,
group=1))+
geom_line()+
theme_minimal()+
ylim(60,75)+
theme(axis.title = element_text(size=12))+
xlab("Starting year-quarter")+
ylab("Percentage of small project contractors")
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,
group=1))+
geom_line()+
theme_minimal()+
ylim(60,75)+
theme(axis.title = element_text(size=14))+
xlab("Starting year-quarter")+
ylab("Percentage of small project contractors")
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,
group=1))+
geom_line()+
theme_minimal()+
ylim(60,75)+
theme(axis.title = element_text(size=12),axis.ticks = element_text(size=12))+
xlab("Starting year-quarter")+
ylab("Percentage of small project contractors")
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,
group=1))+
geom_line()+
theme_minimal()+
ylim(60,75)+
theme(axis.title = element_text(size=12),axis.ticks.x = element_text(size=12))+
xlab("Starting year-quarter")+
ylab("Percentage of small project contractors")
gplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,
group=1))+
geom_line()+
theme_minimal()+
ylim(60,75)+
theme(axis.title = element_text(size=12))+
xlab("Starting year-quarter")+
ylab("Percentage of small project contractors")
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_projects,
group=1))+
geom_line()+
theme_minimal()+
ylim(55,70)+
theme(axis.title = element_text(size=12))+
xlab("Starting year-quarter")+
ylab("Percentage of small projects")
both[,pc_small_contractors:=100*num_small_contractors/(num_small_contractors+num_large_contractors)]
ggplot(both[start_yr_qtr_dt>as.Date('2009-12-31')],aes(x=as.factor(start_yr_qtr_dt),
y=pc_small_contractors,
group=1))+
geom_line()+
theme_minimal()+
ylim(60,75)+
theme(axis.title = element_text(size=12))+
xlab("Starting year-quarter")+
ylab("Percentage of small project contractors")
